<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kilimolink</title>
    <link rel="icon" href="icons/download.webp" type="">
    <link rel="stylesheet" href="assets/home.css">
</head>
<body>
    <div id="user-info" style="display:flex; align-items:center; gap:12px; padding:16px;">
        <span id="user-name" style="font-weight:bold; font-size:1.2em;"></span>
    </div>
    
    <!-- Weather -->
<div class="a">
    <div class="region">
        <br>
        <span class="weather" id="weather-info">
            Loading weather...
        </span>
        <a href="https://openweathermap.org/">Explore more weather details</a>
        <br>
    </div>

<!-- Crops  -->
<div class="crops">
    <h2>Trending Crops in the market</h2>
     <marquee behavior="alternate" direction="left">
     <div class="crops-icons">
        <div class="crop">
            <img src="images/beans.jpeg" alt="Maize">
            <br><span>Beans</span>
        </div>
        <div class="crop">
            <img src="images/cassava.jpeg" alt="Cassava">
            <br><span>Cassava</span>
        </div>
        <div class="crop">
            <img src="images/tomato.jpeg" alt="Tomato">
            <br><span>Tomato</span>
        </div>
        <div class="crop">
            <img src="images/banana.jpg" alt="Maize">
            <br><span>Banana</span>
        </div>
        <div class="crop">
            <img src="images/cabbage.jpeg" alt="Rice">
            <br><span>Cabbage</span>
        </div>
        <div class="crop">
            <img src="images/hoho.jpeg" alt="Cassava">
            <br><span>hoho</span>
        </div>
        <div class="crop">
            <img src="images/mushroom.jpeg" alt="Tomato">
            <br><span>mushroom</span>
        </div>
        <div class="crop">
            <img src="images/onion.jpeg" alt="Maize">
            <br><span>onion</span>
        </div>
        <div class="crop">
            <img src="images/oranges.jpeg" alt="Rice">
            <br><span>orange</span>
        </div>
        <div class="crop">
            <img src="images/irish.jpeg" alt="Cassava">
            <br><span>irish</span>
    </div>
    <div class="crop">
            <img src="images/cucumber.jpeg" alt="Cassava">
            <br><span>cucumber</span>
    </div>
</marquee>
</div>
</div>

<!-- Market Prices -->
 <div class="market-prices">
    <h2>&nbsp;&nbsp; Market Prices</h2>
    <div class="price-item">
        <img src="images/kunde.jpeg" alt="Maize">
        <div class="details">
            <span class="name">Kunde</span>
            <span class="price">1500 Tsh per Kg</span>
        </div>
    </div>
    <div class="price-item">
        <img src="images/beans.jpeg" alt="Rice">
        <div class="details">
            <span class="name">Beans</span>
            <span class="price">2600 Tsh per Kg</span>
        </div>
    </div>
    <div class="price-item">
        <img src="images/cassava.jpeg" alt="Cassava">
        <div class="details">
            <span class="name">Cassava</span>
            <span class="price">5600 Tsh per Kg</span>
        </div>
    </div>
    <div class="price-item">
        <img src="images/tomato.jpeg" alt="Tomatoes">
        <div class="details">
            <span class="name">Tomatoes</span>
            <span class="price">1700 Tsh per Kg</span>
        </div>
    </div>
    <div class="price-item">
        <img src="images/banana.jpg" alt="Cassava">
        <div class="details">
            <span class="name">Banana</span>
            <span class="price">5600 Tsh per Kg</span>
        </div>
    </div>
    <div class="price-item">
        <img src="images/cabbage.jpeg" alt="Tomatoes">
        <div class="details">
            <span class="name">cabbage</span>
            <span class="price">1700 Tsh per Kg</span>
        </div>
    </div>
    <div class="price-item">
        <img src="images/hoho.jpeg" alt="Rice">
        <div class="details">
            <span class="name">Hoho</span>
            <span class="price">2600 Tsh per Kg</span>
        </div>
    </div>
    <div class="price-item">
        <img src="images/mushroom.jpeg" alt="Cassava">
        <div class="details">
            <span class="name">mushroom</span>
            <span class="price">5600 Tsh per Kg</span>
        </div>
    </div>
    <div class="price-item">
        <img src="images/onion.jpeg" alt="Tomatoes">
        <div class="details">
            <span class="name">onion</span>
            <span class="price">1700 Tsh per Kg</span>
        </div>
    </div>
    <div class="price-item">
        <img src="images/cucumber.jpeg" alt="Cassava">
        <div class="details">
            <span class="name">cucumber</span>
            <span class="price">5600 Tsh per Kg</span>
        </div>
    </div>
</div>
<div>
    <!-- promotion and other links -->
     <br>
     <br>
     <br>
     <br>
</div>

<!-- Bottom Navigation Bar -->
<div class="navbar">
        <a href="home.html" class="nav active"><img src="https://th.bing.com/th?q=Home+Icon&w=120&h=120&c=1&rs=1&qlt=70&o=7&cb=1&pid=InlineBlock&rm=3&mkt=en-WW&cc=TZ&setlang=en&adlt=moderate&t=1&mw=247" alt=""><br>home</a>
        <a href="market.html" class="nav"><img src="https://th.bing.com/th/id/OIP.JdNXjqqetFQlgBRzx02g1gHaE8?pid=ImgDet&w=192&h=128&c=7&cb=idpwebp2&o=7&rm=3" alt=""><br>Market</a>
        <a href="expert.html" class="nav"><img src="https://th.bing.com/th/id/OIP.6c-EtQ8EGVJMTmxD0nSlKwHaHa?w=175&h=180&c=7&r=0&o=7&pid=1.7&rm=3" alt=""><br>Expert Service</a>
        <a href="discussion.html" class="nav"><img src="https://cdn-icons-png.flaticon.com/128/1500/1500455.png" alt=""><br>community</a>
        <a href="profile.html" class="nav"><img src="https://cdn-icons-png.flaticon.com/128/4140/4140048.png" alt=""><br>profile</a>
    </div>
<div style="padding: 16px;">
    <label for="city-select"><b>Select your city:</b></label>
    <select id="city-select">
        <option value="Moshi">Moshi</option>
        <option value="Arusha">Arusha</option>
        <option value="Dar es Salaam">Dar es Salaam</option>
        <option value="Dodoma">Dodoma</option>
        <option value="Tanga">Tanga</option>
        <!-- Add more cities as needed -->
    </select>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // User name display
    const user = JSON.parse(localStorage.getItem('user'));
    const userNameSpan = document.getElementById('user-name');
    if (user && user.username) {
        userNameSpan.textContent = `Welcome, ${user.username}!`;
    } else {
        userNameSpan.textContent = '';
    }

    const apiKey = 'f9e1b406bca87e212a6eae3701270d1f';
    const country = 'TZ';
    const weatherInfo = document.getElementById('weather-info');
    const citySelect = document.getElementById('city-select');

    function fetchWeather(city) {
        weatherInfo.textContent = 'Loading weather...';
        fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city},${country}&appid=${apiKey}&units=metric`)
            .then(response => response.json())
            .then(data => {
                if (data.cod === 200) {
                    const temp = Math.round(data.main.temp);
                    const desc = data.weather[0].description;
                    const icon = data.weather[0].icon;
                    weatherInfo.innerHTML = `
                        ${city}, Tanzania <br>
                        ${temp}Â°C, ${desc}
                        <img src="https://openweathermap.org/img/wn/${icon}@2x.png" alt="weather icon" style="vertical-align:middle;">
                    `;
                    // Set dropdown to detected city if present
                    for (let i = 0; i < citySelect.options.length; i++) {
                        if (citySelect.options[i].value.toLowerCase() === city.toLowerCase()) {
                            citySelect.selectedIndex = i;
                            break;
                        }
                    }
                } else {
                    weatherInfo.textContent = 'Weather unavailable';
                }
            })
            .catch(() => {
                weatherInfo.textContent = 'Weather unavailable';
            });
    }

    // Reverse geocode coordinates to city using OpenWeatherMap's geocoding API
    function getCityFromCoords(lat, lon) {
        fetch(`https://api.openweathermap.org/geo/1.0/reverse?lat=${lat}&lon=${lon}&limit=1&appid=${apiKey}`)
            .then(response => response.json())
            .then(data => {
                if (data && data.length > 0 && data[0].name) {
                    fetchWeather(data[0].name);
                } else {
                    fetchWeather(citySelect.value);
                }
            })
            .catch(() => {
                fetchWeather(citySelect.value);
            });
    }

    // Try to get user's location
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            position => {
                getCityFromCoords(position.coords.latitude, position.coords.longitude);
            },
            error => {
                // If denied or error, fall back to dropdown
                fetchWeather(citySelect.value);
            }
        );
    } else {
        // Geolocation not supported
        fetchWeather(citySelect.value);
    }

    // Update weather when city changes
    citySelect.addEventListener('change', function() {
        fetchWeather(this.value);
    });
});
</script>
</body>
</html>